---
title: "Statewide Analysis"
---

## Setup

```{r setup}
library(tidyverse)
library(janitor)
library(lubridate)
```


## Read in Clean Data

```{r read}
df <- read_rds("data-processed/01-storm-data.rds")

df |> glimpse()

```

## Clean up data more for analysis
I am going to remove the unnecessary columns for this analysis and change the order of the columns. I am also going to create a new column that is total damages (damage_val_prop + damage_val_crop).

```{r}
storms <- df |> mutate(
  event_type = EVENT_TYPE,
  location = CZ_NAME,
  FIPS = CZ_FIPS,
  CZ_type = CZ_TYPE

)

storms <- storms |> rowwise() |> mutate(
  total_damages = sum(damage_val_prop, damage_val_crop, na.rm = TRUE)
) |> select(
  event_type,
  location,
  CZ_type,
  FIPS,
  total_damages,
  damage_val_prop,
  damage_val_crop,
  begin_date
)

storms

```


# Answering Statewide Questions

## What do damages from storms look like over time?

```{r}
yr_damages <- storms |> group_by(yr = year(begin_date)) |> 
  summarize(total_damages = sum(total_damages, na.rm = TRUE)) |> 
  arrange(total_damages |> desc())

yr_damages
```

Now let's plot it.

```{r}
ggplot(
  yr_damages,
  aes(x = yr, y =total_damages)
) + geom_col() +
  scale_x_continuous(breaks = seq(2000, 2023, by = 1)) +
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.5))
```

## Which storm types cause the most damage?


```{r most-damage}
#now groupby event type and sum up damages
most_damage <- storms |> group_by(event_type) |> 
  summarize(total_damages = sum(total_damages, na.rm = TRUE)) |> 
  arrange(total_damages |> desc())

most_damage
```

```{r}
most_damage_time <- storms |> group_by(event_type, yr = year(begin_date)) |> 
  summarize(total_damages = sum(total_damages, na.rm = TRUE)) |> 
  arrange(yr |> desc())

most_damage_time
```

```{r}
ggplot (
  most_damage_time,
  aes(x = yr, y = total_damages, color = event_type)
) + geom_line()
```












## Where did the most damaging storms occur?

```{r sort-prop}
sorted_damages_prop <- storms |> arrange(damage_val_prop |> desc())

sorted_damages_prop
```

```{r sort-crop}
sorted_damages_crop <- storms |> arrange(damage_val_crop |> desc())

sorted_damages_crop
```

## What year had the most damages?



## How have the damages from storm events changed over time?

```{r plot-prop}
ggplot(
  storms,
  aes(x = begin_date, y = damage_val_prop)
) +
  geom_point()
```


```{r plot-crop}
ggplot(
  storms,
  aes(x = begin_date, y = damage_val_crop)
) +
  geom_point()
```

